<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Promociones</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    {% load static %}
    <link rel="stylesheet" href="{% static 'estilos.css' %}">
</head>
<body>
   <!-- nav admin -->
   {% include "formatos/navbaradmin.html" %}
   {% block content %}

    <div class="containter mt-5">
        <h2 class="text-center">Panel de Promociones</h2>
        <br>
        <div class="container mt-3">

            <button type="button" class="btn btn-info btn-sm mb-3" data-bs-toggle="modal" data-bs-target="#manualUsuario">
                <i class="fas fa-info-circle"></i> Manual de Usuario
            </button>

            <form  class="d-flex" id="formBuscarProducto" role="search">
                <input type="text" class="form-control me-2" id="buscarProducto" placeholder="Puede buscar el producto por Nombre o ID" aria-label="Buscar">
                <button class="btn btn-success" type="submit">Buscar</button>
            </form>
            <div id="mensaje" class="mt-3"></div>
        </div>

        <table class="table table-bordered mt-4">
            <thead class="table-dark">
                <tr>
                    <th>ID</th>
                    <th>Nombre del Producto</th>
                    <th>Precio</th>
                    <th>% Descuento</th>
                    <th>Precio con descuento</th>
                    <th>Estado</th>
                </tr>
            </thead>
            <tbody id="tablePromociones">
                {% for producto in productos %}
                    <tr>
                        <td>{{ producto.id }}</td>
                        <td>{{ producto.nombre }}</td>
                        <td>${{ producto.precio }}</td>
                        <td>
                            <input type="number" class="form-control" value="{{ producto.descuento }}" min="0" max="100">
                        </td>
                        <td>${{ producto.precio_con_descuento }}</td>
                        <td>
                            <select class="form-select">
                                <option value="Activa" {% if producto.estado == 'Activa' %}selected{% endif %}>Activa</option>
                                <option value="Inactiva" {% if producto.estado == 'Inactiva' %}selected{% endif %}>Inactiva</option>
                            </select>
                        </td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="6" class="text-center">No hay productos disponibles.</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>

        <div class="text-center mt-4">
            <button class="btn btn-success" id="btnAplicarCambios">Aplicar Cambios</button>
        </div>
    </div>


    <!-- Modal del Manual -->
    <div class="modal fade" id="manualUsuario" tabindex="-1" aria-labelledby="manualModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="manualModalLabel">Manual de Uso</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>

                <div class="modal-body">
                    <h4>Bienvenido al Manual para Crear una Promocion de Producto</h4>
                    <p>Este manual le guiará a través de las funcionalidades necesarias para crear una promoción para un producto en el inventario.</p>
             
                    <h5>1. Procedimiento para Modificar Promociones</h5>
                    <ol>
                        <li>Utilice la barra de búsqueda para encontrar el producto que desea modificar.Ingresando el nombre del producto en el campo correspondiente.</li>
                        <li>Presione el botón <strong>"Buscar"</strong> para filtrar los resultados.</li>
                        <li>Una vez localizado el producto en la tabla, identifique la fila correspondiente.</li>
                        <li>En la columna <strong>"% Descuento"</strong>, introduzca el porcentaje de descuento que desea aplicar.</li>
                        <li>Para que la promoción sea válida, asegúrese de cambiar el estado del producto en la columna <strong>"Estado"</strong>. Seleccione <strong>"Activa"</strong> para habilitarla o <strong>"Inactiva"</strong> para deshabilitarla, según lo que necesite.</li>
                        <li>Finalmente, haga clic en el botón <strong>"Aplicar Cambios"</strong> para guardar y confirmar las modificaciones realizadas.</li>
                    </ol>


                    <h5>2. Notas Adicionales</h5>
                    <ul>
                        <li>Los cálculos de descuento se realizan automáticamente una vez se introduce un nuevo valor en la columna "% Descuento".</li>
                        <li>Asegúrese de hacer clic en "Aplicar Cambios" para que las modificaciones queden guardadas.</li>
                    </ul>
                
            
                    
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                </div>
            </div>
        </div>
    </div>



    {% endblock %}
    {% include "formatos/footeradmin.html"%}



<script>
    document.addEventListener('DOMContentLoaded', () => {
        const formBuscarProducto = document.getElementById('formBuscarProducto');
        const resultadoProducto = document.getElementById('tablePromociones');
        const mensaje = document.getElementById('mensaje');
 
        formBuscarProducto.addEventListener('submit', (event) => {
            event.preventDefault();
            const query = document.getElementById('buscarProducto').value.trim().toLowerCase();
            const productosFiltrados = Array.from(resultadoProducto.children).filter(row => {
                const nombre = row.querySelector('td:nth-child(2)').textContent.toLowerCase();
                return nombre.includes(query);
            });
 
            if (productosFiltrados.length > 0) {
                mensaje.innerHTML = '';
                resultadoProducto.innerHTML = '';
                productosFiltrados.forEach(row => resultadoProducto.appendChild(row));
            } else {
                mensaje.innerHTML = '<div class="alert alert-danger">Producto no encontrado.</div>';
                resultadoProducto.innerHTML = '';
            }
        });
    });
</script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        {% if messages %}
            {% for message in messages %}
                Swal.fire({
                    icon: "{% if 'success' in message.tags %}success{% elif 'error' in message.tags %}error{% elif 'info' in message.tags %}info{% else %}warning{% endif %}", // Mapear los tags a SweetAlert
                    title: "{{ message|escapejs }}", // Escapa caracteres especiales para JavaScript
                    showConfirmButton: true,
                    timer: 3000 // Tiempo en milisegundos
                });
            {% endfor %}
        {% endif %}
    });
</script>

</body>
</html>