<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catálogo</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    {% load static %}
    <link rel="stylesheet" href="{% static 'estilos.css' %}">
</head>
<body>
    <!-- NavBar -->
    {% include "formatos/navbaruser.html" %}
    {% block content %}
    <div class="container mt-3">
        <form class="d-flex" role="search">
            <input class="form-control me-2 search-bar" type="search" placeholder="Buscar productos" aria-label="Buscar">
            <button class="btn btn-outline-success" type="submit">Buscar</button>
        </form>
    </div>
    
    <!-- faltaría añadir el stock   -->
    <!-- Catálogo de los productos  -->
    <div class="container mt-5">
        <div class="row">
            
            <!-- Producto 1 -->
            <div class="col-md-3 mb-4">
                <div class="card h-100">
                    <a href="producto1.html">
                        <img src="{% static 'media/lecheEntera1Lt.webp' %}" class="card-img-top" alt="Leche Entera 1LT">
                    </a>
                    <div class="card-body text-center">
                        <h5 class="card-title">Leche Entera 1LT</h5>
                        <p class="card-text">$1300</p>
                        <button class="btn btn-primary add-to-cart" data-product-id="1" data-price="1300" data-name="Leche Entera 1LT" data-image="media/lecheEntera1Lt.webp">Agregar al carrito</button>
                        <a href="Detalleproducto1.html" class="btn btn-primary">Ver Detalle</a>
                    </div>
                </div>
            </div>

            <!-- Producto 2 con descuento 20% -->
            <div class="col-md-3 mb-4">
                <div class="card h-100">
                    <img src="{% static 'media/panIdeal700G.webp' %}" class="card-img-top" alt="Pan Ideal 700g">
                    <div class="card-body text-center">
                        <h5 class="card-title">Pan Ideal 700g</h5>
                        <p class="precio-original">$4300</p>
                        <p class="precio-descuento">$3440</p>
                        <p class="porcentaje-descuento">Descuento del 20%</p>
                        <button class="btn btn-primary add-to-cart" data-product-id="2" data-price="3440" data-name="Pan Ideal 700g" data-image="media/panIdeal700G.webp">Agregar al carrito</button>
                        <a href="Detalleproducto1.html" class="btn btn-primary">Ver Detalle</a>
                    </div>
                </div>
            </div>

            <!-- Producto 3 -->
            <div class="col-md-3 mb-4">
                <div class="card h-100">
                    <img src="{% static 'media/fantaRetornable2LT.jpg' %}" class="card-img-top" alt="Fanta Retornable 2LT">
                    <div class="card-body text-center">
                        <h5 class="card-title">Fanta Retornable 2LT</h5>
                        <p class="precio-original">$1,900</p>
                        <p class="precio-descuento">$1,520</p>
                        <p class="porcentaje-descuento">Descuento del 20%</p>
                        <button class="btn btn-primary add-to-cart" data-product-id="3" data-price="1900" data-name="Fanta Retornable 2LT" data-image="media/fantaRetornable2LT.jpg">Agregar al carrito</button>
                        <a href="Detalleproducto1.html" class="btn btn-primary">Ver Detalle</a>
                    </div>
                </div>
            </div>

            <!-- Producto 4 con descuento 15% -->
            <div class="col-md-3 mb-4">
                <div class="card h-100">
                    <img src="{% static 'media/cerealChocoKrispis.webp' %}" class="card-img-top" alt="Cereal Choco Krispis 500g">
                    <div class="card-body text-center">
                        <h5 class="card-title">Cereal Choco Krispis 500g</h5>
                        <p class="precio-original">$2500</p>
                        <p class="precio-descuento">$2125</p>
                        <p class="porcentaje-descuento">Descuento del 15%</p>
                        <button class="btn btn-primary add-to-cart" data-product-id="4" data-price="2125" data-name="Cereal Choco Krispis 500g" data-image="media/cerealChocoKrispis.webp">Agregar al carrito</button>
                        <a href="Detalleproducto1.html" class="btn btn-primary">Ver Detalle</a>
                    </div>
                </div>
            </div>

            
        </div>
    </div>

    <!-- vista del modal -->

    <div class="modal fade" id="cartModal" tabindex="-1" aria-labelledby="cartModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-top-right">
            <div class="modal-content border-0 shadow">
                <div class="modal-header bg-navbar-custom">
                    <h5 class="modal-title" id="cartModalLabel">Tu carrito de compras</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body p-4">
                    <table class="table table-hover align-middle">
                        <thead class="table-light">
                            <tr>
                                <th class="product-name">Producto</th>
                                <th>Precio</th>
                                <th>Cantidad</th>
                                <th>Total</th>
                                <th>Acción</th>
                            </tr>
                        </thead>
                        <tbody id="cart-items">
                            <!-- Aquí se cargan los productos del carrito -->
                        </tbody>
                    </table>
                    <div class="text-end mt-3">
                        <h5><span id="cart-total" class="fw-bold">$0.00</span></h5>
                    </div>
                </div>
                <div class="modal-footer justify-content-between">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button type="button" class="btn btn-outline-danger" id="empty-cart">Vaciar carrito</button>
                    <button type="button" class="btn btn-success">Finalizar compra</button>
                </div>
            </div>
        </div>
    </div>
    {% endblock %}
    {% include "formatos/footeruser.html"%}
    <!-- Footer -->

    <!-- Scripts -->
    
    <script>
        let cart = [];
        const cartCountElement = document.getElementById('cart-count');
    
        function updateCartCount() {
            const itemCount = cart.reduce((total, product) => total + product.quantity, 0);
            cartCountElement.textContent = itemCount;
        }
    
        function addToCart(productId, productName, productPrice, productImage) {
            const existingProduct = cart.find(item => item.id === productId);
            if (existingProduct) {
                existingProduct.quantity += 1;
            } else {
                cart.push({ id: productId, name: productName, price: productPrice, quantity: 1, image: productImage });
            }
            updateCartCount();
            displayCart();
        }
    
        function displayCart() {
            const cartItemsElement = document.getElementById('cart-items');
            const cartTotalElement = document.getElementById('cart-total');
            cartItemsElement.innerHTML = '';
    
            let total = 0;
    
            cart.forEach(product => {
                const { id, name, price, quantity, image } = product;
                const subtotal = price * quantity;
                total += subtotal;
    
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <div class="product-info d-flex align-items-center">
                            <img src="${image}" alt="${name}" width="50" height="50" class="me-2">
                            <span>${name}</span>
                        </div>
                    </td>
                    <td>$${price}</td>
                    <td class="text-center">
                        <div class="quantity-control"> <!-- Usa esta clase para el contenedor -->
                            <button class="btn btn-quantity change-quantity me-2" data-product-id="${id}" data-action="decrease">-</button>
                            <span class="quantity-number">${quantity}</span> <!-- Clase para centrar el número -->
                            <button class="btn btn-quantity change-quantity ms-2" data-product-id="${id}" data-action="increase">+</button>
                        </div>
                    </td>
                    </td>
                    <td>$${subtotal}</td>
                    <td><button class="btn btn-danger remove-from-cart" data-product-id="${id}">Eliminar</button></td>
                `;
                cartItemsElement.appendChild(row);
            });
            cartTotalElement.innerHTML = `<strong>Total: $${total}</strong>`;
        }
    
        function removeFromCart(productId) {
            const productIndex = cart.findIndex(item => item.id === productId);
            if (productIndex !== -1) {
                cart.splice(productIndex, 1);
                updateCartCount();
                displayCart();
            }
        }
    
        function changeQuantity(productId, action) {
            const product = cart.find(item => item.id === productId);
            if (product) {
                if (action === 'increase') {
                    product.quantity += 1;
                } else if (action === 'decrease' && product.quantity > 1) {
                    product.quantity -= 1;
                }
                displayCart();
            }
        }
    
        function emptyCart() {
            cart = [];
            updateCartCount();
            displayCart();
        }
    
        document.querySelectorAll('.add-to-cart').forEach(button => {
            button.addEventListener('click', (event) => {
                const productId = parseInt(button.getAttribute('data-product-id'));
                const productName = button.getAttribute('data-name');
                const productPrice = parseFloat(button.getAttribute('data-price'));
                const productImage = button.getAttribute('data-image');
                addToCart(productId, productName, productPrice, productImage);
            });
        });
    
        document.getElementById('cart-items').addEventListener('click', (event) => {
            if (event.target.classList.contains('remove-from-cart')) {
                const productId = parseInt(event.target.getAttribute('data-product-id'));
                removeFromCart(productId);
            } else if (event.target.classList.contains('change-quantity')) {
                const productId = parseInt(event.target.getAttribute('data-product-id'));
                const action = event.target.getAttribute('data-action');
                changeQuantity(productId, action);
            }
        });
    
        document.getElementById('empty-cart').addEventListener('click', emptyCart);
    
        document.getElementById('cart-toggle').addEventListener('click', displayCart);
    
        updateCartCount();
    </script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
